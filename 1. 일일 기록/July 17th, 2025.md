---
title: "July 17th, 2025"
created: 2025-07-17 06:44:52
updated: 2025-08-04 19:19:10
---
  * 오늘 할 일
    * 함수 정의에서 패킹 예. 확인
  * 명경지수 -> 명징한 생각
  * 오늘 일 중 꼭 기억할 것은?
  * 내가 한 일 중 중요하고도 잘 했던 일은?
  * 07:16 cig 2
  * 08:47 오늘 비바람이 거세다. 잠깐 담배 피우러 나갔다 왔는데 위 티셔츠까지도 약간 젖었다. 아래쪽은 말할 것도 없이..
  * 10:18 cig 4
  * 10:26 pdf_markdown_reader.py 분석 시작
    * LlamaIndexDocument를 사용. 아마 rag-embedding에서 llama_index framework을 사용하는 모양.
    * _process_nested_tables(): pdf 모든 페이지 돌면서 호출해서 enhanced_markdown을 생성
      * 이 안에서 여러 자체 개발 함수 호출.
    * enhanced_markdown은 LlamaIndexDocument에 인자로 넘겨서 실행결과로 document 생성
  * 11:00 일단 multi_column.py와 pymupdf_rag.py를 고친 부분을 김희민 매니저에게 듣고 이해해야 할 것 같다.
  * 11:02 llama에 있는 pdf_markdown_reader.py와 pymupdf_rag.py 관계가 있는지 확인 시작.
    * pdf_markdown_reader.py에서 호출하는 pymupdf_rag.py 함수
      * IdentifyHeaders 수정하지 않음.
      * to_markdown 수정함. 이것이 결정적인 연결고리.
      * to_markdown 수정 내용
        * 일부 코드 블록을 아예 빼버림. 이유 알 필요가 있다.
        * 표안의 표를 추출하는 것은 아예 새로 개발한 것이라서 이건 내가 스스로 로직을 파악해야 할 것 같지만 to_markdown 수정한 것은 이유를 알아야 할 필요가 있다. 그래야 중첩표 추출과 to_markdown 수정한 것이 연결되어서 전체를 파악할 수 있을 것 같다.
  * 11:32 to_markdown 로그 분석 시작
    * 다른 파일에서 각각 logger를 설정해서 나중에 추가한 것은 로그 파일이 따로 생겼는데도 원래 로그 파일에도 나중에 추가한 로그가 다 찍혔다.
  * 12:14 cig 5
  * 13:37 cig 6
  * 13:42 김희민 매니저도 보청기 끼네!! 우와!! 이렇게 반가울 수가!!
  * 13:55 to_markdown 디버그 로그 추가 시작
    * write_text()부터 헷갈리기 시작.
  * 14:31 to_markdown 디버그 로그 작업
    * 14:34 로그 추가 일단락. 프로그램 실행
  * 14:59 실행 후, 로그 분석
    * too few rows and columns가 세 번 나옴.
    * pymupdf4llm의 default extraction과 enhanced extraction 비교
      * default는 파일명만, enhanced는 그림 관련 인자 추가.
      * enhanced에는 "문서 정보" 그림이 있다는 것을 표시하지만 글을 추출하지 않음. 이 비교는 이거 말고는 의미가 없음.
  * 15:31 default extraction 뺀 후, 다시 실행.
    * p6
      * TableExtraction: 일반 표와 그림 속 표가 있는데 to_markdown에서는 이게 둘 다 잡힌다!
        * output_tables와 output_images 결과 글이 추출되지 않는다. 대신 write_text안에 get_raw_lines에서 잡힌다.
        * 그런데 write_text는 그냥 공백을 돌려주나?
        * write_text 결과와 다르게 이상하게 raw data: 5 rows로 나오는데...
        * md string from output tables 로그를 보면 표내용이 찍힌다. write_text가 아닌 다른 것이 표에 있는 글을 제대로 추출하는 듯한데...역시 "해지 당일" 이후, SKT가 중간에 잘린다.
  * 16:03 cig 7
  * 16:15 p6 로그 분석 계속
    * 아까 표가 두 개 잡힌 것에서 두 번째 표는 그림 속 표가 아닌 제목 "기본요약 및 연관콘텐츠" 이게 잡힌 듯.
    * 이 후 get_raw_lines에 나온 것은 표뿐만 아니라 표 위에 있는 일반 글도 찍힘.
    * 이후 4593줄에 그림을 가리키는 표시글이 뜸.
    * 4618, 4622줄에 그림 속 표 내용을 보여주는데...output md에는 왜 안 나온 거지? 표가 나오는 경우와 비교.
    * p7 이건 표 2개 둘 다 md로 전환되었지만 첫 번째 표가 병합칸이 제대로 표시되지 않음.
      * 4655줄 표가 두 개 잡힌 것으로 나옴.
      * 4658 column_boxes Rect 13개. 13은 무엇일까?
      * 4661 nlines from get_raw_lines에는 위에 나온 Rect(4개)뿐만 아니라 각종 정보가 있음.
      * 4662 nlines after intersects_rects는 위와 동일.
      * 4663 lrect도 위와 동일...아...이건 표가 아니다...지금까지 봤던 것 nlines 등은 표만 가려내는 것이 아니다.
      * 4800에 나오는 출력이 진짜 표 내용을 출력하는 것. Processing table 0이 대부분인데 1도 있는 것(4616, 6897)은...p6 이건 진짜 표가 두 개. 그 외는 반드시 일치하지 않는 듯.
      * 로그 분석 결과, parms.tabs 배열 객체에 적용하는 extract가 문제? 아니면 extract 이전에 parms.tabs 배열에 저장하는 로직이 문제? 아니면 그냥 find_tables로 얻은 객체를 다 까서 그냥 전처리?
  * 일정
    * 7월 18일까지 Document loader 구현
    * 8월 1일까지
      * 데이터 적재 배치 프로그램 구현 (Migration) 기존 데이터 기준
      * 글 전처리/나누기 1차
    * 8월 15일까지
      * 글 전처리/나누기 2차
      * 문서 변경분 embedding
    * 8월 29일까지
      * 메타 확정 버전으로 데이터 적재 배치 프로그램 구현 (Migration)
      * 구현 모듈 통합 연동
    * 9월 1,2주 평가
    * 9월 3,4주 평가 결과 반영 및 데이터 전체 적재 및 나누니, 메타 테이블 상태 현행화 구현
  * 17:17 일단 김희민 매니저가 pymupdf_rag.py 수정한 것을 살펴보기
    * is_significant()에서 widths, heights 설정하고 크기 비교하는 것을 뺌. paths? 
    * to_markdown에서 detect_bg_color, ignore_alpha 인자 뺌.
    * 597, 602 삭제
    * hdr_string = max_header_id 위치 변경?
    * all_mono 처리 코드 추가, 변경?
    * hdr_string에 all_strikeout 위치 변경, all_italic 변경
    * 그 외 md의 각종 prefix, suffix 변경
    * out_string += "\n\n" 삭제
    * make TextPage 코드 추가
    * img_info 존재 여부 코드 삭제
    * 표 행렬 수가 0일 때만 제거?
    * fallback 코드 추가
    * 폰트 처리 코드 추가
    * tableto_markdown_with_nested 함수 추가
  * 18:03 cig 8
  * 20:09 gemini cli 설치
    * 터미널에 npx https://github.com/google-gemini/gemini-cli 
  * 20:26 cig 10
