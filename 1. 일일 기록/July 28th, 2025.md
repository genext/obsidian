---
title: "July 28th, 2025"
created: 2025-07-28 07:10:24
updated: 2025-07-28 18:03:30
---
  * 할 일
    * khm의 custom_pdf FALLBACK을 써서 결과 재확인해보기. 제목이 반복해서 나타나는 버그가 없어야 한다. -> 나중에 안 사실인데 내가 custom_pdf 소스를 내 pc로 타이핑하면서 복사하는 과정에서 똑같이 복사하지 않아서 생긴 오류.
    * debuger 써서 행이 하나씩 밀리는 원인 찾기 -> 일단 해봤고 괜찮다. 나중에 정말 문제가 안 잡힐 때 쓰기로.
    * 김희민 매니저에게 LlamaIndexDocument를 쓴 이유와 꼭 써야 하는지 물어보기
    * 표 안에 표가 있는 칸을 처리해서 표에 해당하는 글을 지우고 따로 뺀 표를 가리키도록 치환 -> 이건 전처리에서 하면 되는 건데 내가 생각의 미로에 빠져서 엉뚱하게 pymupdf_rag.py에서 다 처리하려고 했다. 바보같이...
      * pymupdf 소스 중 table 객체에 속하는 to_markdown을 직접 고쳐서 파일을 읽는 단계에서 전처리까지 동시에 해서 md를 만들 것인가?
      * 일단 패키지를 그대로 이용하되 거기서 나온 md를 전처리라는 과정을 거쳐서 만들 것인가?
    * 병합칸 채우는 방법 pymupdf4llm에서 찾아서 khm 소스에 넣기
    * batch 적재 시간 측정 필요
  * 명경지수 -> 명징한 생각
  * 부모표일 때 자식표 넣어야 하는 것 아닌지? 그런데 몇 행, 몇 렬인지 어떻게 알지? table_md가 행별로 분리되어있나? -> 그냥 나중에 전처리 프로그램에서 문자열 처리하면 된다.
  * 07:43 cig 2
  * 07:50 
    * FALLBACK 결과 확인
      * 확실히 제목 빠진 것 제대로 처리하고 반복해서 나타나지 않는다. 이건 개발 완료!
    * code-server에 있는 pymupdf_rag 현재 버전에도 FALLBACK이 그대로 있다.
      * 이건 테스트한 결과 결과가 거의 동일하지만 하나 다른 것이 있다. 오히려 이것이 제대로 처리하고 cutom_pdf가 잘못 처리한 것이 드러난 듯.
    * 결론: 내가 주말에 제목 처리하려고 뻘짓한 것 헛수고. FALLBACK을 그대로 쓰기로 하고 대신 부모,자식 관계 tagging, 자식표 내용 치환 부분만 복사.
  * 08:10 내 작업과 khm 작업 합치기
    * khm은 llama의 pdf_markdown_reader.py 씀. 이건 pymupdf_rag.py 호출.
    * 난 pdf2markdown.py 씀. 이것도 pymupdf_rag.py 호출.
  * 09:46 이상하네. 왜 부모표 이름 붙이지 않지? 분명히 됐는데...알고 보니 FALLBACK이 있으면 안 된다. 젠장...
  * 09:58 cig 3
  * FALLBACK 중 "# Add tables" 블록에 있는  content_items.append가 문제다!! 그런데 이것을 빼면 결과가 다소 이상해진다. 결국 이것을 그대로 쓰되, table_to_markdown_with_nested()에서 모든 처리를 해야 할 것이다.
  * 10:39 이제야 내 컴퓨터와 개발 PC 소스 파일 동기화가 제대로 이루어졌다. 젠장...이제 table_to_markdown_with_nested를 수정해서 내가 작업한 것을 넣으면 된다.
  * 일단 get_table_tag를 추가해서 부모, 자식표에 이름표 다는 것 처리.
  * 이제 자식표 내용을 부모표에서 삭제하고 다른 글로 치환하는 것 시작
    * replace_child_table_content_in_markdown가 자식표를 찾는 방법은 intersection과 child_rect 겹치는 것 비교.
  * 12:22 cig 4
  * 13:49 pymupdf_rag.py의 to_markdown을 이용해서 md를 얻으면 그걸 전처리? 아....내가 "This table...", "Nested table" 이걸 넣은 이유가 전처리 때문인데...
  * 14:18 내가 너무 바보같이 굴었다. 문제 정의도 제대로 못하고 엉뚱한 데에 시간을 낭비했다. 내가 했어야 할 건 그냥 전처리였다. 김희민 매니저는 이미 거의 다 처리해줬고 난 다만 전처리를 위해 부모, 자식표를 구분할 수 있는 표식만 markdown에 넣으면 되는 것이었다.
  * 14:42 cig 5
  * 16:17 cig 6
  * 16:40 하...이상하네...내 pc에서는 preprocess가 잘 되는데 왜 code-server에서는 표 하나만 작업하지? 다른 부모표는 왜 작업하지 않지?
  * 16:51 이제 남은 일.
    * service 디렉토리에 pdf 관련 모듈 만들기
      * migration_loader.py
        * 디렉토리 탐색
        * 병렬 수행?
          * 함수 load_pdf(파일명)
          * 함수 pre_process(파일명)
      * load_pdf.py
        * load_pdf(file_name: str)
      * preprocess.py
        * pre_process(file_name) 
    * api 호출 클래스
    * endpoint api 개발
      * 인자: 문서 번호
      * load_pdf 호출
      * pre_process 호출
      * metadata 조회 호출
      * md와 metadata를 Document 객체에 저장해서 돌려주기
  * 18:03 cig 7