---
title: "July 21st, 2025"
created: 2025-07-21 08:10:06
updated: 2025-08-08 10:57:25
---
  * 할 일
    * 김희민 매니저이 만든 프로그램 결과 파일 md에 pymupdf4ll이 추출하지 못했던 그림 속 글도 제대로 추출되었는지 확인 -> 잘 되는 것 같다.
    * 디버거 설정 여러 개 시도해보기
    * batch 적재 시간 측정 필요
  * 명경지수 -> 명징한 생각
  * 8:05 cig 2
  * 08:27 jira에 모듈 단위테스트 항목이 있는데 파일 올리기가 권한 때문에 안 된다.
  * 09:50 cig 3
  * 09:59 pdf_markdown_reader.py 분석을 위해 로그 추가 작업 시작
    * 너무 세세하게 하기보다는 일단 pdf_markdown_reader의 결과물부터 먼저 확인. pdf와 비교하면서 빠진 것 없는지 확인해야 하니까.
  * 스크럼 회의 준비
    * 김희민 매니저가 수정한 오픈소스 돌려서 md 결과가 대개 제대로 나오는 것 확인.
      * 확인한 로그: custom_pdf/table_extraction.log
      * p6 잘 안 나오는 것. 
        * 상품가입 칸에 다른 글이 섞여 있다.
        * SKT 잘리는 것. 다른 데는 안 잘린다.
        * 이미지에 있는 표. 어느 것이 김희민 매니저가 처리한 것인지 모르겠다.
    * 그런데 표안에 자세히 보기라는 것이 있고 여기에 url(구비서류)이 있다. 이건 어떻게 해야 하나? -> 이거 신경 쓸 시간이 없다. 일단 중첩표와 병합칸 처리에 집중하면서 다음주까지 fastAPI api 모듈을 만들어야 한다.
    * md로 바꿀 때, 병합칸은 다 풀어서 표시? p19 청년 전용 혜택은 문제가 될 듯.
    * RAG설계/DB설계/문서 메타데이터, 청크 메타 데이터 -> 이 항목들을 위한 정보를 결과 md에 저장?
    * chunking 기준. 제목 번호? 모든 문서는 제목 번호가 있을까? 그냥 폰트로 제목을 구분하는 문서는 없을까?
    * 이번 주 목표. 
      * 중첩표 내 글 삭제 처리 및 치환
      * chunking해서 따로 저장?
  * 10:29 설계 문서 작성 요청 받아서 confluence에 설계 내용 작성 시작
  * 11:34 아. 왜 logger 설정이 안 먹히지...하다 안 돼서 그냥 config 안 쓰고 했다.
  * 11:56 cig 4
  * 13:01 로그가 너무 난잡하지만 enhanced_markdown으로만 찾아서 pymupdf4llm이 제대로 추출하지 못한 글과 중첩표를 제대로 표시한 것을 확인.
  * 13:13 cig 5
  * 13:17 chunking을 어떤 기준으로 할까?
    * 현 테스트 PDF 문서 구조 분석
      * 주요 내용: 번호가 없는데 markdown에서 이게 제목이라고 판단할 수 있는 방법? 다음 제목까지?
      * 0. 기본요약 및 연관콘텐츠: 페이지 중간에 시작.
      * 1. 기본제공: 한 페이지
      * 1. 1회성 충전 부가요금제: 위 기본제공과 함께 있다.
      * 1. 연령 초과 요금제 변경 MMS: 한 페이지
      * 1. 출시일
      * 2. 데이터 상세
      * 2. 가입/해지
      * 2. 맞춤형 요금제 가입 MMS
      * 2. 가입대상
      * 3. 음성/문자 기본 제공
      * 3. 기타 사항
      * 3. 맞춤형 옵션(1회성 충전) MMS
      * 3. 0 청년 59 맞춤형 요금제 혜택
      * 4. 각종 할인 제도
      * 4. 필수 안내 사항
      * 5. 공통사항
      * 5. 기타
      * 6. 업무처리지침
    * 페이지 구분 양상
      * 한 제목 한 페이지
      * 한 페이지에 두 개 이상 제목
      * 한 제목 여러 페이지
      * 중첩표가 있는 페이지: 
  * 14:43 cig 6
  * 17:21 회의가 길었다.
    * 스크립트로 실행하면 fastAPI 내 api를 호출할 수 있나? -> 아마 되지 않을 테고 그냥 DB api를 호출하면 된다.
  * IdentifyHeaders: 동일
  * to_markdown
    * detect_bg_colors, ignore_alpha 인자 뺌.
    * 아래 코드 뺌
      * ```python
if doc.is_form_pdf or doc.has_annots():
  doc.bake()```
    * 코드 변경
      * 아래 코드처럼 [] 추가
      * ```python
elif not all([hasattr(m, "*float*") for m in margins]):```
    * parms.line_rect.append(lrect) 아래 코드 블럭 삭제
    * hdr_string = max_header_id(spans, page=parms.page) 줄 삭제
    * 괄호 뺌
      * ```python
all_bold = all([s...]) 이런 식으로 ()안에 괄호를 뺌.```
    * 추가 코드 write_text()안에
      * ```python
# full line mono-spaced?
if not IGNORE_CODE:
  all_mono =all(s["flags"] & 8 for s in spans])
else:
  all_mono = False

if all_mono and not hdr_string:
  if not code:
    out_strings += "'''\n"
    code = True
    delta = int((lrect.x0 - clip.x0) / (spans[0]["size"] * 0.5))
    indent = " " * delta

    out_string += indent + text + "\n"
    continue

if hdr_string:
  if all_mono...
  if all_italic:
    text = "*" + text + "*"
  if all_bold:...
  if all_strikeout:
    text = "~~" + text + "~~"```
    * 코드 삭제: # start or extend a code block 부분부터 span0 = spans[0] 직전까지
    * 수정: # decode font properties 밑에
      * ```python
mono = s["flags"] & 8 and IGNORE_CODE is False```
    * 코드 삭제: if mono: 부분 두 개 삭제
    * italic을 위에서처럼 _에서 *로 수정
    * 코드 삭제: 722줄 out_string += "\n\n"
    * page_is_ocr()에 try/except 간소화
    * 코드 수정
      * ```python
parms.accept_invisible = page_is_ocr(page)

# determin background color
parms.gb_color = get_bg_color(page)```
    * 코드 수정: # make a TextPage for all ... 밑에 코드에서 try/except 간소화
    * 코드 삭제: # subset of images ...부터 img_info = img_info[:30] 직전까지 삭제
    * 코드 수정: omitted_table_rects = [] 밑에
      * ```python
if not table_strategy:
  parms.tabs = None
else:
    parms...
    이 줄에 로그 추가 len{parms.tabls.tables}

# only remove tables with 0 rows or 0 columns
if t.row_count == 0 or t.col_count ==0: 으로 조건 변경```
    * 코드 삭제: # FALLBACK  부분부터 다음 주석까지
    * 코드 수정 및 추가
      * ```python
# omit clipped text,...
textflags = (
  0
  | mupdf.FZ_..
  | mupdf....
  | 이 줄은 주석 풀고 이 밑에 숫자 지우기
)
try:
  test_flags = textflags | 32768
  textflags = test_flags
except: 에러 처리```
    * 코드 추가: 사진
  * 생각할 것
    * 우선순위
      * api 형태로 내 모듈을 호출 할 수 있게
        * 전체 적재와 한 문서만 처리하는 걸 한 api로?
        * 전체 적재는 병렬수행? 그럼 그 다음은?
    * 다음주까지 할 일 목록으로 만들고 일별 계획 작성
  * api 설계 ^2cnjFf7vv
    * ```plain text
인자: List of ser_num: str
pdf 읽고 processing하는 것 병렬 처리(100개 제한)
 - 인자가 None -> 루트 전체 디렉토리 세기
 - 인자가 List이면 요소 수 세기

md 파일을 embedding하는 api 호출(20개 제한)
vectorDB 저장(10개 제한)
RDB에서 메타데이터 읽기(20개 제한)
RDB에 처리 내용 저장(20개 제한)

각 테스트 시간 2시간
embedding
vectorDB 저장
RDB read/write```
  * 20:28 api 설계 후 잠시 쉬는 중이다. 앞으로 포모도로 활용해서 꼭 쉬면서 명상하는 시간을 갖자
  * 20:31 오늘 일기 쓰기 시작
    * 일기 다 쓰고 중간에 pdf_markdown_reader.py를 수정했다.
    * 코드 줄 맞추기 때문에 extension(black formatter, ruff)을 설치
    * pip을 써서 ruff를 설치하려는데 pip 명령어가 안 잡힌다. python도 python3로 해야 한다.
  * nomad coder의 claude code 동영상 강의 시청 ->2025.8.8. 완료
  * 21:18 우분투에 이미 python2가 설치되어 있고 이건 시스템 전체에 적용되는 것. 따라서 python3 설치할 때 주의! pip3도 따로 설치
    * ```shell
sudo apt update
sudo apt install python3-pip```
  * uv 설치
    * ```shell
pip3 install uv가 제대로 실행되지 않음.
curl -LsSf https://astral.sh/uv/install.sh | sh```