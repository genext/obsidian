---
title: "July 24th, 2024"
created: 2024-07-24 07:04:32
updated: 2025-09-08 14:58:55
---
  * 06:58 출근. 커피가 없다.
  * 오늘 할 일
    * 업무 메일 확인
    * 테이블 생성/임시 데이터 저장. MyBatis 작성

  * 오늘 하고 싶은 것
  * 08:01 테이블 생성 시작
    * 비고를 desc, 조건을 condition으로 했는데 이건 예약어 -> `condition`은 backtick으로 감싸고 desc는 rmk로 변경.
    * 일련번호 seq을 auto-increment로 하는 것을 까먹음. 파이썬 프로그램에 일단 넣었지만 주석으로 막음. alter 명령어로 수동으로 작업하기로 함.
  * 08:31 생성한 테이블 중 일련번호 속성을 auto-increment로 바꾸는 작업 시작.
    * 곧 끝냈고 이제 임시 데이터를 넣는 스크립트를 만들까 생각했지만 화면 데이터를 보고 수동으로 넣기로 마음을 바꿈.
  * [[디지털 바우처 회의록]] [[Roam/genext-2025-10-05-02-18-30/디지털 바우처 회의록#^_RIemnyu3|```plain text
- 시간: 2024. 7. 24. 수.
- 장소: 소회의실
- 주제: 일일회의
- 핵심 요약:
    - 8/7 ~ 13 분석 감리
    - 대표와 고승진 과장은 이번 주내로 개발환경 설정 마무리
    - 개발자 투입 준비 문제점
- 회의 후 반성
```]]
  * 09:49 임시 데이터 생성 시작. 화면 설계서에 나온 임시 데이터 위주로.
    * 일단 유형, 단계, 상태 등 코드성 데이터를 정의.
      * 바우처 유형
        * 캐시백: CAB
        * 보조금: AUX
      * 바우처 지급방식
        * A, B로 구분
      * 바우처 처리 단계
        * 미신청: NAP
        * 신청: APP
        * 결재요청: STA
        * 결재완료: SET
      * 상태
        * 승인: Y
        * 반려: N
        * 대기: S
      * 바우처 지급상태
        * 지급: Y
        * 미지급: N
        * 지급 대기: S
      * 은행 코드
        * 신한: 088
        * 우리: 020
        * KB국민은행 004
  * 11:32 4개비
  * 11:37 TB_VOUCH_INDST 테이블이 있으면 TB_INDST도 있어야 한다. 일단 만들자.
  * 11:50 임시 데이터 생성 시작
    * 메뉴 테이블 생성할 때 수정을 반복하게 된다. MENU_ID를 INT로 바꾸고 PARENT_MENU_ID 값이 0일 때는 상위 메뉴가 없는 것으로 하는 등...
  * 12:21 메뉴 임시 데이터 생성 시작
    * [x] 메뉴 관련 테이블이나 코드체계 등은 다른 프로젝트에서도 반복해서 나타난다. 이것을 라이브러리화 할 필요가 있다. 아니면 내가 직접 정리
  * 12:51 TB_VOUCH_TRGET 임시 데이터 생성 시작
    * 이용자별 메뉴 TB_VOUCH_USER_MENU 데이터를 넣으려 하다 보니 좀 이상하다.
      * 이용자와 메뉴를 연결하면 이용자가 늘어날 때마다 데이터가 늘어난다. 이건 아니고 이용자 집단별로 나눠야 한다.
      * ERD와 테이블 설계서 수정
  * 13:22 TB_VOUCH_GRP_MENU 테이블 새로 작성 시작.
  * 13:45 5개비
  * 13:54 임시 데이터 생성 완료
  * 15:02 MyBatis 분석 시작 ^R53QoVu78
    * MyBatis 작업 순서
      * create a java entity class to represent the database table.
        * User.java
          * ```java
package com.example.demo.model;

public class User {
    private Long id;
    private String name;
    private String email;

    // Getters and Setters
}
```
      * create a MyBatis mapper interface.
        * UserMapper.java with sql statements at once.
          * ```java
package com.example.demo.mapper;

import com.example.demo.model.User;
import org.apache.ibatis.annotations.*;

import java.util.List;

@Mapper
public interface UserMapper {

    @Select("SELECT * FROM users")
    List<User> findAll();

    @Select("SELECT * FROM users WHERE id = #{id}")
    User findById(Long id);

    @Insert("INSERT INTO users(name, email) VALUES(#{name}, #{email})")
    @Options(useGeneratedKeys = true, keyProperty = "id")
    void insert(User user);

    @Update("UPDATE users SET name=#{name}, email=#{email} WHERE id=#{id}")
    void update(User user);

    @Delete("DELETE FROM users WHERE id=#{id}")
    void delete(Long id);
}
```
        * UserMapper.java without sql staements.
          * ```java
package com.example.demo.mapper;

import com.example.demo.model.User;
import org.apache.ibatis.annotations.Mapper;

import java.util.List;

@Mapper
public interface UserMapper {
    List<User> findAll();
    User findById(Long id);
    void insert(User user);
    void update(User user);
    void delete(Long id);
}
```
      * create a XML mapper file
        * UserMapper.xml when I didn't put sql statements in the UserMapper.java
          * ```java
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.UserMapper">
    <select id="findAll" resultType="com.example.demo.model.User">
        SELECT * FROM users
    </select>

    <select id="findById" parameterType="long" resultType="com.example.demo.model.User">
        SELECT * FROM users WHERE id = #{id}
    </select>

    <insert id="insert" parameterType="com.example.demo.model.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO users(name, email) VALUES(#{name}, #{email})
    </insert>

    <update id="update" parameterType="com.example.demo.model.User">
        UPDATE users SET name=#{name}, email=#{email} WHERE id=#{id}
    </update>

    <delete id="delete" parameterType="long">
        DELETE FROM users WHERE id=#{id}
    </delete>
</mapper>
```
      * create a service class to use mapper interface
        * UserService.java
          * ```java
package com.example.demo.service;

import com.example.demo.mapper.UserMapper;
import com.example.demo.model.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserService {

    @Autowired
    private UserMapper userMapper;

    public List<User> findAll() {
        return userMapper.findAll();
    }

    public User findById(Long id) {
        return userMapper.findById(id);
    }

    public void save(User user) {
        if (user.getId() == null) {
            userMapper.insert(user);
        } else {
            userMapper.update(user);
        }
    }

    public void delete(Long id) {
        userMapper.delete(id);
    }
}
```
      * create a controller
        * UserController.java
          * ```java
package com.example.demo.controller;

import com.example.demo.model.User;
import com.example.demo.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/users")
public class UserController {

    @Autowired
    private UserService userService;

    @GetMapping
    public List<User> findAll() {
        return userService.findAll();
    }

    @GetMapping("/{id}")
    public User findById(@PathVariable Long id) {
        return userService.findById(id);
    }

    @PostMapping
    public void save(@RequestBody User user) {
        userService.save(user);
    }

    @DeleteMapping("/{id}")
    public void delete(@PathVariable Long id) {
        userService.delete(id);
    }
}
```
    * 테이블명 TB_WALLET_MASTER로 소스 전체 검색한 것 중 중요한 것.
      * kr.or.cbdc.domain.main.model.com.wallet.mastr.TbWalletMastr.java
        * public class TbWalletMastr extends **TbWalletMastrEntity**
          * 이 클래스에서 DB 속성 모두 정의.
        * kr.or.cbdc.domain.main.model.com.wallet.mastr.TbWalletMastrEntity.java
          * public class TbWalletMastrEntity extends **MainEntity**
          * [x] MainEntity는 BaseEntity 상속하고 BaseEntity는 Serializable을 구현. 이 관계를 이해할 필요가 있음.
      * TbWalletMastrEntityMapper.xml, TbWalletMastrMapper.xml
      * TbPdmWalletMastrEntity.xml, TbPdmWalletMastrMapper.xml
        * 차이는 Pdm이 붙은 것은 시중은행용이고 없는 것은 bok용.
    * 15:50 MyBatis 분석 중 Mapper 시작
      * kr.or.cbdc.domain.main.mapper.com.wallet.WalletMastrEntityMapper 지갑 인터페이스
        * ```java
package kr.or.cbdc.domain.main.mapper.com.wallet;

import java.util.HashMap;
import java.util.List;

import org.apache.ibatis.annotations.Param;

import kr.or.cbdc.domain.main.model.com.wallet.mastr.TbWalletMastr;

public interface WalletMastrEntityMapper {

    /**
     *  유효한 지갑 전체 조회
     *
     * @return
     * 
     */
    public List<TbWalletMastr> selectList();

    /**
     * 상세조회
     *
     * @param walletId
     * @return
     */
    public TbWalletMastr select(@Param("walletId") String walletId);

    
    /**
     * 조회
     *
     * @param walletAdres
     * @return
     */
    public TbWalletMastr selectByAddr(@Param("walletAdres") String walletAdres);

    /**
     * 최종 생성
     *
     * @param tbWalletMastr
     * @return
     */
    public int insert(@Param("tbWalletMastr") TbWalletMastr tbWalletMastr);

    /**
     * 삭제
     *
     * @param walletId
     * @return
     */
    public int delete(@Param("walletId") String walletId);

     /**
     * 지갑정보 조회
     *
     * @param walletSe
     * @return
     */
    public TbWalletMastr selectWalletSe(@Param("walletSe") String walletSe);


    /**
     * Owner 지갑 주소 조회
     * 
     * @return
     */
    public HashMap<String,String> getOwner();


}
```
      * WalletMastrEntityMapper 을 상속받은 인터페이스가 각 시스템별로 존재함
        * Bok  : TbWalletMastrMapper
        * Bank : TbPdmWalletMastrMapper
        * Ewa  : TbEwaWalletMastrMapper
  * 16:25 이제는 entity class부터 interface, xml mapper 작성 시작할 때.
    * 파이썬 스크립트 작성해서 동일한 엑셀 파일 읽어서 자바 엔터티 클래스 코드 생성
  * 16:34 6개비
  * 18:16 7개비
  * 남은 것은 interface와 mapper.
  * 19:23 8개비
  * 20:33 9개비