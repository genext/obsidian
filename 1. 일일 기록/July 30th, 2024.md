---
title: "July 30th, 2024"
created: 2024-07-30 06:58:55
updated: 2024-10-24 13:31:59
---
  * 06:51 출근
  * 오늘 할 일
    * 업무 메일 확인
    * 어제 작업한 것 점검 및 파악

  * 오늘 하고 싶은 것
  * 08:20 swagger를 authorize 없이 사용하기 위해 config 수정할 필요. swagger config 클래스를 찾아서 security 관련 코드를 주석으로 막았지만 여전히 ROLE 관련 에러 발생.
  * 09:24 DaaS pc에서 docker desktop을 돌리면 에러가 발생하기 때문에 wsl2를 설치.
    * windows terminal 설치하고 필요한 명령어 실행
    * 리눅스 배포판 다운로드 및 설치하려고 했지만 DaaS pc에 문제가 있는 듯. wsl --install이 안 먹힌다.
  * 10:22 rest controller 로그 삽입해서 DB 조회 안 되는 이유 조사 시작.
    * slfj logger 삽입 전 로그
      * ```shell
2024-07-30 10:23:19.661 INFO  [18752:http-nio-8085-exec-10] k.o.c.i.f.m.p.dao.interceptor.BaseSqlInterceptor   [] === SQL Mapper ==> kr.or.cbdc.application.common.menu.mapper.MenuLoadMapper.selectMenuIdsByMenuPath
2024-07-30 10:23:19.661 DEBUG [18752:http-nio-8085-exec-10] k.o.c.a.c.m.m.M.selectMenuIdsByMenuPath            [] ==>  Preparing: /* kr.or.cbdc.application.common.menu.mapper.MenuLoadMapper.selectMenuIdsByMenuPath */ SELECT TSM.MENU_ID FROM TB_SYS_MENU TSM WHERE TSM.MENU_PATH = ? ORDER BY TSM.MENU_LEVEL DESC, TSM.MENU_ORDR
2024-07-30 10:23:19.661 DEBUG [18752:http-nio-8085-exec-10] k.o.c.a.c.m.m.M.selectMenuIdsByMenuPath            [] ==> Parameters: /api-docs/json(String)
2024-07-30 10:23:19.665 DEBUG [18752:http-nio-8085-exec-10] k.o.c.a.c.m.m.M.selectMenuIdsByMenuPath            [] <==      Total: 0
2024-07-30 10:23:25.683 INFO  [18752:QuartzScheduler_bokCBDC-LAPTOP-BJQMP20M1722302595230_ClusterManager] org.quartz.impl.jdbcjobstore.JobStoreTX            [] ClusterManager: detected 1 failed or restarted instances.
2024-07-30 10:23:25.683 INFO  [18752:QuartzScheduler_bokCBDC-LAPTOP-BJQMP20M1722302595230_ClusterManager] org.quartz.impl.jdbcjobstore.JobStoreTX            [] ClusterManager: Scanning for instance "LAPTOP-BJQMP20M1722297022727"'s failed in-progress jobs.
2024-07-30 10:23:28.178 DEBUG [18752:http-nio-8085-exec-1] org.springframework.security.web.FilterChainProxy  [ANONYMOUS-USER-000-0:0:0:0:0:0:0:1] Securing GET /vc/pbm
2024-07-30 10:23:28.185 DEBUG [18752:http-nio-8085-exec-1] o.s.s.w.a.AnonymousAuthenticationFilter            [ANONYMOUS-USER-000-0:0:0:0:0:0:0:1] Set SecurityContextHolder to anonymous SecurityContext
2024-07-30 10:23:28.185 DEBUG [18752:http-nio-8085-exec-1] o.s.s.access.hierarchicalroles.RoleHierarchyImpl   [ANONYMOUS-USER-000-0:0:0:0:0:0:0:1] getReachableGrantedAuthorities() - From the roles [ROLE_ANONYMOUS] one can reach [ROLE_ANONYMOUS] in zero or more steps.
2024-07-30 10:23:28.187 DEBUG [18752:http-nio-8085-exec-1] o.s.s.w.access.intercept.FilterSecurityInterceptor [ANONYMOUS-USER-000-0:0:0:0:0:0:0:1] Failed to authorize filter invocation [GET /vc/pbm] with attributes [ROLE_ADMIN, ROLE_SUPER, ROLE_BANK, ROLE_BLOCK_TEST]
```
    * TB_SYS_AUTHOR 테이블을 보면, "ROLE_"로 시작하는 여러 권한이 있다.
    * [x] 보안 설정 관련해서 filterChain과 FilterSecurityInterceptor 등 구조 파악 필요. 즉, 스프링부트에서 보안 관련 일반 설정 파악 필요.
      * security configuration class (usually a class annotated with @EnableWebSecurity).
    * 이미 보안 관련해서 filter와 interceptor 설정되었으면 이를 수정하는 것보다 기존 시스템에 등록된 이용자로 로그인하면 되지 않을까?
      * swagger의 authorize 버튼을 누르면 jwt 값을 넣도록 되어 있는데 이 값은 어디서?
  * 11:23 5개비
  * 12:07 대표님에게 얘기해서 swagger는 단순히 config 바꿔서 할 수 있는게 아니라고 설명하니 23층에 전화해서 물어보고 postman 설치해서 로그인하라고 함.
  * 12:51 23층에서 개발자가 와서 swagger 쓸 수 있게 해줌
    * admin/admin으로 로그인 -> api 호출 주소와 파라미터는 postman에 저장함.
    * 바우처 api 조회 된다!
  * 12:51 6개비
  * 12:59 일단 어제까지 작업한 바우처 CRUD 중 R은 된다. 이제 작업한 내용을 다시 보면서 머릿속에 확실하게 각인할 필요가 있다.
    * 13:01 내 작업 분석 시작
      * 기본적인 프로젝트 소스 구조
        * application: 응용
        * domain: 기본적인 CRUD만
      * 나는 바우처 마스터 테이블에 한 해 기본적인 CRUD만 가능한 모듈을 만들기 때문에 이후 작업은 모두 domain에 있다.
      * DB
        * [x] TB_VOUCH_MASTR 테이블에서 SC 부분 삭제 필요
        * VO(Value Object): 도메인에서 한 개 또는 그 이상 속성을 묶어서 특정값을 나타내는 객체 의미.
          * [x] https://tecoble.techcourse.co.kr/post/2020-06-11-value-object/ 정리하고 확실하게 파악
          * equals & hash code 메소드 정의해야 한다.
            * equals
              * 두 객체를 비교할 때 동등성과 동일성(==)은 다르다.
                * 동등성: 객체에 있는 속성값이 같은지 비교하기 위해서 equals 메소드 재정의.
                * 동일성: 동일한 속성값을 가진 객체라도 메모리 저장위치는 다르므로 동일하지 않다.
            * hash code
              * 따로 정하지 않으면 객체 주소값을 가지고 해시코드 생성. 속성값이 같은 객체는 동등하다는 것을 표현하기 위해 속성값을 가지고 해시코드 생성. 
            * 코드 예.
              * ```java
 @Override
    public boolean equals(final Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        final Point point = (Point) o;
        return x == point.x &&
                y == point.y;
    }

    @Override
    public int hashCode() {
        return Objects.hash(x, y);
    }```
        * Entity 객체와 응용 객체 구분
          * Entity 객체에 테이블 정의가 있고 단순 CRUD 대상
          * 응용 객체는 Entity 객체 상속하고 응용(관리)에 필요한 속성과 메소드 추가.
          * 소스
            * 위치: /project_root/src/main/java/kr.or/cbdc/domain/main/model/voucher/pbm/mastr
              * TbVcMastrEntity.java
                * 코드
                  * ```java
package kr.or.cbdc.domain.main.model.voucher.pbm.mastr;

import java.util.Date;

import kr.or.cbdc.domain.main.model.MainEntity;
import lombok.experimental.SuperBuilder;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Getter
@Setter
@SuperBuilder
@NoArgsConstructor
abstract class TbVcMastrEntity extends MainEntity{

    /**
     * 바우처 관리
     */
    private static final long serialVersionUID = 1L;
    protected String vouchId;
    protected String reqInstId;
    protected String vouchManageNo;
    protected String vouchNm;
    protected String vouchTy;
    protected String vouchPymntTy;
    protected String vouchProcStep;
    protected String vouchProcSttus;
    protected Date vouchRcritStartDt;
    protected Date vouchRcritEndDt;
    protected Date vouchRegDt;
    protected Date vouchReqstDt;
    protected Date vouchConfmDt;
    protected Date vouchExprtnDt;
    protected Date vouchWdtbDt;
    protected String vouchPymntSttus;
    protected String vouchIsuWalletId;
    protected String vouchRedempWalletId;
    protected Date vouchErnrsCreatDt;
    protected Long vouchTotamt;
    protected Double vouchBlce;
    protected String vouchBankCode;
    protected String scWdtbInfo;
    protected String scAbi;
    protected String scBytecode;
    protected Date scVrifyReqDt;
    protected Date scVrifyComptDt;
    protected String scVrifyComptResult;
    protected String scReturnResn;
    protected Date scConfmDt;
    protected Date scWdtbDt;
    protected String scStep;
    protected String scCnd;
    protected String scVer;
    protected Date scCndChangeDt;
    protected String scCndChanger;

}```
              * TbVcMastr.java
                * 코드
                  * ```java
package kr.or.cbdc.domain.main.model.voucher.pbm.mastr;

import kr.or.cbdc.infrastructure.idgen.util.IdGenerationUtil;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import lombok.experimental.SuperBuilder;

@Getter
@Setter
@SuperBuilder
@NoArgsConstructor
public class TbVcMastr extends TbVcMastrEntity {

    private static final long serialVersionUID = -5767295897536796925L;

    protected String applcntNm;
    protected String sanctnSttusNm;
    protected String sanctnerNm;
    protected String trnscCmpterNm;
    protected String sanctnNm;
    protected String vcIsuSttusNm;
    protected String trgetInsttNm;

    public TbVcMastr newId() {
        this.setVouchId(IdGenerationUtil.createUid("TB_VOUCH_MASTR"));

        return this;
    }

}
```
      * xml mapper + mapper interface
        * [x] xml mapper
          * sql문이 있으며 mapper interface에서 호출하는 대상. 따라서 namespace에 mapper interface 위치가 들어감.
          * 소스
            * 위치: /project_root/src/main/resources/configuration/mapper.main-mysql/domain/voucher/pbm
            * TbVcMastrEntityMapper.xml
              * ```java
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
 바우처 마스터 Entity Mapper
-->
<mapper namespace="kr.or.cbdc.domain.main.mapper.voucher.pbm.TbVcMastrEntityMapper">

    <!-- 조회 -->
    <select id="select" resultType="kr.or.cbdc.domain.main.model.voucher.pbm.mastr.TbVcMastr">
        <![CDATA[
            SELECT
                VOUCH_ID,
                REQ_INST_ID,
                VOUCH_MANAGE_NO,
                VOUCH_NM,
                VOUCH_TY,
                VOUCH_PYMNT_TY,
                VOUCH_PROC_STEP,
                VOUCH_PROC_STTUS,
                VOUCH_RCRIT_START_DT,
                VOUCH_RCRIT_END_DT,
                VOUCH_REG_DT,
                VOUCH_REQST_DT,
                VOUCH_CONFM_DT,
                VOUCH_EXPRTN_DT,
                VOUCH_WDTB_DT,
                VOUCH_PYMNT_STTUS,
                VOUCH_ISU_WALLET_ID,
                VOUCH_REDEMP_WALLET_ID,
                VOUCH_ERNRS_CREAT_DT,
                VOUCH_TOTAMT,
                VOUCH_BLCE,
                VOUCH_BANK_CODE,
                SC_WDTB_INFO,
                SC_ABI,
                SC_BYTECODE,
                SC_VRIFY_REQ_DT,
                SC_VRIFY_COMPT_DT,
                SC_VRIFY_COMPT_RESULT,
                SC_RETURN_RESN,
                SC_CONFM_DT,
                SC_WDTB_DT,
                SC_STEP,
                SC_CND,
                SC_VER,
                SC_CND_CHANGE_DT,
                SC_CND_CHANGER
            FROM
                TB_VOUCH_MASTR
        ]]>
    </select>

    <!-- 바우처 생성 -->
    <insert id="insert">
        <![CDATA[
            INSERT INTO TB_VOUCH_MASTR (
                VOUCH_ID,
                REQ_INST_ID,
                VOUCH_MANAGE_NO,
                VOUCH_NM,
                VOUCH_TY,
                VOUCH_PYMNT_TY,
                VOUCH_PROC_STEP,
                VOUCH_PROC_STTUS,
                VOUCH_RCRIT_START_DT,
                VOUCH_RCRIT_END_DT,
                VOUCH_REG_DT,
                VOUCH_REQST_DT,
                VOUCH_CONFM_DT,
                VOUCH_EXPRTN_DT,
                VOUCH_WDTB_DT,
                VOUCH_PYMNT_STTUS,
                VOUCH_ISU_WALLET_ID,
                VOUCH_REDEMP_WALLET_ID,
                VOUCH_ERNRS_CREAT_DT,
                VOUCH_TOTAMT,
                VOUCH_BLCE,
                VOUCH_BANK_CODE,
                SC_WDTB_INFO,
                SC_ABI,
                SC_BYTECODE,
                SC_VRIFY_REQ_DT,
                SC_VRIFY_COMPT_DT,
                SC_VRIFY_COMPT_RESULT,
                SC_RETURN_RESN,
                SC_CONFM_DT,
                SC_WDTB_DT,
                SC_STEP,
                SC_CND,
                SC_VER,
                SC_CND_CHANGE_DT,
                SC_CND_CHANGER
            ) VALUES (
                #{tbVcMastr.vouchId},
                #{tbVcMastr.reqInstId},
                #{tbVcMastr.vouchManageNo},
                #{tbVcMastr.vouchNm},
                #{tbVcMastr.vouchTy},
                #{tbVcMastr.vouchPymntTy},
                #{tbVcMastr.vouchProcStep},
                #{tbVcMastr.vouchProcSttus},
                #{tbVcMastr.vouchRcritStartDt},
                #{tbVcMastr.vouchRcritEndDt},
                #{tbVcMastr.vouchRegDt},
                #{tbVcMastr.vouchReqstDt},
                #{tbVcMastr.vouchConfmDt},
                #{tbVcMastr.vouchExprtnDt},
                #{tbVcMastr.vouchWdtbDt},
                #{tbVcMastr.vouchPymntSttus},
                #{tbVcMastr.vouchIsuWalletId},
                #{tbVcMastr.vouchRedempWalletId},
                #{tbVcMastr.vouchErnrsCreatDt},
                #{tbVcMastr.vouchTotamt},
                #{tbVcMastr.vouchBlce},
                #{tbVcMastr.vouchBankCode},
                #{tbVcMastr.scWdtbInfo},
                #{tbVcMastr.scAbi},
                #{tbVcMastr.scBytecode},
                #{tbVcMastr.scVrifyReqDt},
                #{tbVcMastr.scVrifyComptDt},
                #{tbVcMastr.scVrifyComptResult},
                #{tbVcMastr.scReturnResn},
                #{tbVcMastr.scConfmDt},
                #{tbVcMastr.scWdtbDt},
                #{tbVcMastr.scStep},
                #{tbVcMastr.scCnd},
                #{tbVcMastr.scVer},
                #{tbVcMastr.scCndChangeDt},
                #{tbVcMastr.scCndChanger}
            )
        ]]>
    </insert>

    <!-- 바우처 수정 -->
    <update id="update">
        <![CDATA[
            UPDATE TB_VOUCH_MASTR SET
                REQ_INST_ID = #{tbVcMastr.reqInstId},
                VOUCH_MANAGE_NO = #{tbVcMastr.vouchManageNo},
                VOUCH_NM = #{tbVcMastr.vouchNm},
                VOUCH_TY = #{tbVcMastr.vouchTy},
                VOUCH_PYMNT_TY = #{tbVcMastr.vouchPymntTy},
                VOUCH_PROC_STEP = #{tbVcMastr.vouchProcStep},
                VOUCH_PROC_STTUS = #{tbVcMastr.vouchProcSttus},
                VOUCH_RCRIT_START_DT = #{tbVcMastr.vouchRcritStartDt},
                VOUCH_RCRIT_END_DT = #{tbVcMastr.vouchRcritEndDt},
                VOUCH_REG_DT = #{tbVcMastr.vouchRegDt},
                VOUCH_REQST_DT = #{tbVcMastr.vouchReqstDt},
                VOUCH_CONFM_DT = #{tbVcMastr.vouchConfmDt},
                VOUCH_EXPRTN_DT = #{tbVcMastr.vouchExprtnDt},
                VOUCH_WDTB_DT = #{tbVcMastr.vouchWdtbDt},
                VOUCH_PYMNT_STTUS = #{tbVcMastr.vouchPymntSttus},
                VOUCH_ISU_WALLET_ID = #{tbVcMastr.vouchIsuWalletId},
                VOUCH_REDEMP_WALLET_ID = #{tbVcMastr.vouchRedempWalletId},
                VOUCH_ERNRS_CREAT_DT = #{tbVcMastr.vouchErnrsCreatDt},
                VOUCH_TOTAMT = #{tbVcMastr.vouchTotamt},
                VOUCH_BLCE = #{tbVcMastr.vouchBlce},
                VOUCH_BANK_CODE = #{tbVcMastr.vouchBankCode},
                SC_WDTB_INFO = #{tbVcMastr.scWdtbInfo},
                SC_ABI = #{tbVcMastr.scAbi},
                SC_BYTECODE = #{tbVcMastr.scBytecode},
                SC_VRIFY_REQ_DT = #{tbVcMastr.scVrifyReqDt},
                SC_VRIFY_COMPT_DT = #{tbVcMastr.scVrifyComptDt},
                SC_VRIFY_COMPT_RESULT = #{tbVcMastr.scVrifyComptResult},
                SC_RETURN_RESN = #{tbVcMastr.scReturnResn},
                SC_CONFM_DT = #{tbVcMastr.scConfmDt},
                SC_WDTB_DT = #{tbVcMastr.scWdtbDt},
                SC_STEP = #{tbVcMastr.scStep},
                SC_CND = #{tbVcMastr.scCnd},
                SC_VER = #{tbVcMastr.scVer},
                SC_CND_CHANGE_DT = #{tbVcMastr.scCndChangeDt},
                SC_CND_CHANGER = #{tbVcMastr.scCndChanger}
            WHERE
                VOUCH_ID = #{tbVcMastr.vouchId}
        ]]>
    </update>

    <!-- 바우처 삭제 -->
    <delete id="delete">
        <![CDATA[
            DELETE FROM TB_VOUCH_MASTR
            WHERE VOUCH_ID = #{vouchId}
        ]]>
    </delete>

</mapper>```
            * [x] 의문점. 왜 result 타입이 TbVcMastr일까?
        * mapper interface
          * 소스
            * 위치: /project_root/src/main/java/kr.or/cbdc/domain/main/mapper/voucher/pbm
            * TbVcMastrEntityMapper.java
              * ```java
package kr.or.cbdc.domain.main.mapper.voucher.pbm;

import kr.or.cbdc.domain.main.model.voucher.pbm.mastr.TbVcMastr;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 바우처 마스터 Entity Mapper
 */
public interface TbVcMastrEntityMapper {

    /**
     * 조회
     *
     * @return 바우처 목록
     */
//    public TbVcMastr select(@Param("vouchId") String vouchId);
    List<TbVcMastr> select();

    /**
     * 생성
     *
     * @param tbVcMastr
     * @return 저장한 건수
     */
    int insert(@Param("tbVcMastr") TbVcMastr tbVcMastr);

    /**
     * 수정
     *
     * @param tbVcMastr
     * @return 처리한 건수
     */
    int update(@Param("tbVcMastr") TbVcMastr tbVcMastr);

    /**
     * 삭제
     *
     * @param vouchId
     * @return 삭제한 건수
     */
    int delete(@Param("vouchId") String vouchId);

    /**
     * txHash 업데이트
     * @param vouchId, resultTxHash
     * @return
     */
//    int transctionHashUpdate(@Param("vouchId") String vouchId, @Param("resultTxHash") String resultTxHash);


}
```
      * Service
        * interface
          * 소스
            * 위치: /project_root/src/main/java/kr.or/cbdc/application/voucher/pdm/service
            * TbVcMastrService.java
              * ```java
package kr.or.cbdc.application.voucher.pbm.service;

import kr.or.cbdc.domain.main.model.voucher.pbm.mastr.TbVcMastr;

import java.util.List;

public interface TbVcMastrService {
    List<TbVcMastr> select();

    int create(TbVcMastr tbVcMastr);

    int update(TbVcMastr tbVcMastr);

    int delete(String vouchId);
}```
        * implementation
          * 위치: /project_root/src/main/java/kr.or/cbdc/application/voucher/pdm/service
          * TbVcMastrServiceImpl.java
            * ```java
package kr.or.cbdc.application.voucher.pbm.service;

import kr.or.cbdc.domain.main.mapper.voucher.pbm.TbVcMastrEntityMapper;
import kr.or.cbdc.domain.main.model.voucher.pbm.mastr.TbVcMastr;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class TbVcMastrServiceImpl implements TbVcMastrService {

    private final TbVcMastrEntityMapper tbVcMastrEntityMapper;

    @Autowired
    public TbVcMastrServiceImpl(TbVcMastrEntityMapper tbVcMastrEntityMapper) {
        this.tbVcMastrEntityMapper = tbVcMastrEntityMapper;
    }

    @Override
    public List<TbVcMastr> select() {
        return tbVcMastrEntityMapper.select();
    }

    @Override
    public int create(TbVcMastr tbVcMastr) {
        return tbVcMastrEntityMapper.insert(tbVcMastr);
    }

    @Override
    public int update(TbVcMastr tbVcMastr) {
        return tbVcMastrEntityMapper.update(tbVcMastr);
    }

    @Override
    public int delete(String vouchId) {
        return tbVcMastrEntityMapper.delete(vouchId);
    }
}
```
      * Rest Controller
        * 위치: /project_root/src/main/java/kr.ir/cbdc/application/voucher/pbm/controller
        * VcManageRestController.java
          * ```java
package kr.or.cbdc.application.voucher.pbm.controller;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.tags.Tag;
import kr.or.cbdc.application.voucher.common.model.ManageHeader;
import kr.or.cbdc.infrastructure.grid.model.GridRequest;
import org.apache.commons.lang3.ObjectUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Profile;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.math.BigInteger;
import java.util.List;

import kr.or.cbdc.domain.main.model.voucher.pbm.mastr.TbVcMastr;
import kr.or.cbdc.application.voucher.pbm.service.TbVcMastrService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
/**
 * 바우처 관리 RestController
 */
@Tag(name = "2-2.바우처 관리", description = "디지털 바우처 프로젝트")
@RestController
@RequestMapping(path = "/vc/pbm")
@Profile("!bok & !bok-live & !bok-poc")
public class VcManageRestController {

    private final TbVcMastrService tbVcMastrService;
    private static final Logger logger = LoggerFactory.getLogger(VcManageRestController.class);

    @Autowired
    public VcManageRestController(TbVcMastrService tbVcMastrService) {
        this.tbVcMastrService = tbVcMastrService;
    }

    /**
     * 바우처 전체 조회
     * @throws Exception
     *
     */
    @Operation(summary = "바우처 목록 조회", description = "바우처 전체 목록을 조회한다.")
    @GetMapping
    public ResponseEntity<List<TbVcMastr>> select() throws Exception {
        List<TbVcMastr> tbVcMastrList = tbVcMastrService.select();
        return ResponseEntity.ok(tbVcMastrList);
    }

    /**
     * 바우처 생성
     * @param tbVcMastr
     */
    @Operation(summary = "바우처 생성", description = "바우처를 새로 생성")
    /*
    @Parameter(name = "body",  content = @Content(mediaType = "application/json", schema = @Schema(type = "object", example = """
            {
                "paging": {
                    "recordCountPerPage": 10,
                    "pageListCount": 10,
                    "currentPageNo": 1,
                    "totalRecordCount": 8,
                    "orderBy": {
                        "columnList": [
                            {
                                "columnName": "TRNSC_COMPT_DT",
                                "sortDirection": "DESC"
                            }
                        ]
                    }
                },
                "search": {
                    "stDt": "20211212",
                    "edDt": "20251214"
                }
            }""")))
            */
    @PostMapping
    public ResponseEntity<String> create(@RequestBody TbVcMastr tbVcMastr) {
        logger.debug("create request received");
        int result = tbVcMastrService.create((tbVcMastr));
        if (result > 0) {
            logger.debug("create ok");
            return ResponseEntity.ok("Created successfully");
        }
        else {
            logger.error("what happened?");
            return ResponseEntity.status(500).body("Failed to create");
        }
    }

    /**
     * 바우처 수정
     *
     * @param tbVcMastr
     * @return
     */
    @Operation(summary = "바우처 내용 수정", description = "기존 바우처 정보를 수정한다")
    @PutMapping
    public ResponseEntity<String> update(@RequestBody TbVcMastr tbVcMastr) {
        int result = tbVcMastrService.update(tbVcMastr);
        if (result > 0) {
            return ResponseEntity.ok("Updated successfully");
        }
        else {
            return ResponseEntity.status(500).body("Failed to update");
        }
    }

    /**
     * 바우처 삭제
     *
     * @param vouchId
     */
    @Operation(summary = "바우처 삭제", description = "바우처 삭제한다")
    @DeleteMapping("/{vouchId}")
    public ResponseEntity<String> delete(@PathVariable("vouchId") String vouchId) {
        int result = tbVcMastrService.delete(vouchId);
        if (result > 0) {
            return ResponseEntity.ok("Deleted successfully");
        }
        else {
            return ResponseEntity.status(500).body("Failed to delete");
        }
    }

}```
  * 13:57 대표님이 30분 전에 나를 다시 불러서 DB 관련 작업 요청
    * TB_COIN_MASTR는 스마트계약용으로. 바우처 마스터에 있는 스마트계약 관련 데이터는 뺀다.
    * 이용자는 bokv의 TB_CSTMR_MASTR를 사용.
    * [x] 그렇게 ERD를 수정하고 프로그램 목록이 나오면 테이블과 연결
    * [x] VOUCH_ID가 TB_COIN_MASTR에 추가되어야 하니 내가 smartcontract가 참조하는 테이블명을 TB_COIN_MASTR에서 TB_VOUCH_COIN_MASTR로 바꾸겠다니까 그대로 두라고 했는데 확인 필요.
      * TB_COIN_MASTR를 그대로 이용할 생각이어서 그 테이블에 VOUCH_ID를 추가할 수 없고 역으로 바우처 마스터에 COIN_ID를 넣기로.
  * 15:09 swagger 바우처 조회 api 실행 결과(json)
    * ```plain text
[
  {
    "_JOB_TYPE": null,
    "_META_MAP": null,
    "vouchId": "123456789012345678",
    "reqInstId": "1",
    "vouchManageNo": "20240600025555555",
    "vouchNm": "서울 임신출산 바우처",
    "vouchTy": "AUX",
    "vouchPymntTy": "A",
    "vouchProcStep": "APP",
    "vouchProcSttus": "Y",
    "vouchRcritStartDt": 1719154800000,
    "vouchRcritEndDt": 1721660400000,
    "vouchRegDt": 1718377200000,
    "vouchReqstDt": 1718463600000,
    "vouchConfmDt": null,
    "vouchExprtnDt": 1735570800000,
    "vouchWdtbDt": null,
    "vouchPymntSttus": null,
    "vouchIsuWalletId": null,
    "vouchRedempWalletId": null,
    "vouchErnrsCreatDt": null,
    "vouchTotamt": null,
    "vouchBlce": null,
    "vouchBankCode": "088",
    "scWdtbInfo": null,
    "scAbi": null,
    "scBytecode": null,
    "scVrifyReqDt": null,
    "scVrifyComptDt": null,
    "scVrifyComptResult": null,
    "scReturnResn": null,
    "scConfmDt": null,
    "scWdtbDt": null,
    "scStep": null,
    "scCnd": null,
    "scVer": null,
    "scCndChangeDt": null,
    "scCndChanger": null,
    "applcntNm": null,
    "sanctnSttusNm": null,
    "sanctnerNm": null,
    "trnscCmpterNm": null,
    "sanctnNm": null,
    "vcIsuSttusNm": null,
    "trgetInsttNm": null
  }
]```
  * [x] 15:30 바우처 생성 api 호출 실패
  * 15:33 bokv의 TB_CSTMR_MASTR를 bok에 복사.
  * 15:53 ERD 수정 및 테이블 생성 필요.
    * 사용처, 의뢰기관은 TB_PRT_CMPNY 복사해서 새로 생성
      * 사용처 테이블: TB_VOUCH_PLACE
      * 의뢰기관 테이블: TB_VOUCH_INSTT
    * 사용처, 의뢰기관 소속 직원은 CSTMR_MASTR를 복사해서 생성
      * 사용처 직원 테이블: TB_VOUCH_PLACE_EMP
      * 의뢰기관 직원 테이블: TB_VOUCH_INSTT_EMP
  * 16:44 대표에게 테이블 생성한 것 알림.
  * 16:47 ERD 수정 시작
  * 17:51 바우처 생성 에러 디버그 시작
    * 에러
      * Caused by: org.apache.ibatis.binding.BindingException: Parameter 'tbVouchMastrEntity' not found. Available parameters are [$var, tbVcMastr, param1]
      * 원인
        * TbVcMastrEntityMapper.xml에 insert문에 #{tbVouchMastrEntity.vouchId}가 있음. rest controller에서 주는 parameter는 
        * ```java
public ResponseEntity<String> create(@RequestBody TbVcMastr tbVcMastr)```
      * 조치
        * tbVouchMastrEntity를 tbVcMastr로 수정.
    * 성공한 requestbody
      * ```plain text
{
  "vouchId": "12",
  "reqInstId": "1",
  "vouchManageNo": "string",
  "vouchNm": "string",
  "vouchTy": "string",
  "vouchPymntTy": "string",
  "vouchProcStep": "string",
  "vouchProcSttus": "1",
  "vouchRcritStartDt": "2024-07-30T08:53:45.477Z",
  "vouchRcritEndDt": "2024-07-30T08:53:45.477Z",
  "vouchRegDt": "2024-07-30T08:53:45.477Z",
  "vouchReqstDt": "2024-07-30T08:53:45.477Z",
  "vouchConfmDt": "2024-07-30T08:53:45.477Z",
  "vouchExprtnDt": "2024-07-30T08:53:45.477Z",
  "vouchWdtbDt": "2024-07-30T08:53:45.477Z",
  "vouchPymntSttus": "1",
  "vouchIsuWalletId": "string",
  "vouchRedempWalletId": "string",
  "vouchErnrsCreatDt": "2024-07-30T08:53:45.477Z",
  "vouchTotamt": 0,
  "vouchBlce": 0,
  "vouchBankCode": "string",
  "scWdtbInfo": "string"
}```
  * 18:28 update도 OK
  * 18:32 swagger에서 delete test 불가능. vouchId를 입력 받지 않는다.
    * 원인
      * swagger annotation이 잘못 됨.
        * ```java
 @Operation(summary = "바우처 삭제", description = "바우처 삭제한다")
    @DeleteMapping
    public ResponseEntity<String> delete(@PathVariable String vouchId) {
        int result = tbVcMastrService.delete(vouchId);
        if (result > 0) {
            return ResponseEntity.ok("Deleted successfully");
        }
        else {
            return ResponseEntity.status(500).body("Failed to delete");
        }
    }
```
    * [x] 조치. 코드 수정한 것 반영.
      * ```java
// 수정한 부분
 @DeleteMapping("/{vouchId}")
    public ResponseEntity<String> delete(@PathVariable("vouchId") String vouchId) {```
  * 18:53 퇴근 전에 작업 마무리 다 하고 commit까지 했어야 한다.